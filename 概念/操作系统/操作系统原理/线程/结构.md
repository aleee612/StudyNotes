
**Summary：**
> 线程 = 执行流 + 运行时状态（由内核或线程库维护）
> → 一般称线程映象为：TCB + 线程私有运行环境
> → 线程不独立拥有程序和数据，它们来自所属进程
---
### 线程不单独拥有的部分（共享）
#### 程序段（代码段）
- 存放可执行指令
- **只读**
- **同一进程内所有线程共享**
- 不因线程创建而复制
 对线程来说：**代码不是它的结构，只是它执行的对象**
---
#### 数据段 / 堆
包括：
- 全局变量
- 静态变量
- 常量区
- 堆（malloc / new）
特点：
- **线程间共享**
- 访问需要同步（互斥、原子操作）
---
### TCB：线程控制模块（核心）
1. **线程标识符（TID）**
    - 线程唯一标识
    - 位于 TCB 中
2. **线程状态**：就绪 / 运行 / 阻塞
3. **处理机状态信息（线程上下文）**
    - 程序计数器（PC）
    - 通用寄存器
    - PSW / 状态寄存器  
        **线程切换 = 保存 / 恢复这些内容**
4. 调度信息
    - 优先级
    - 时间片
    - 等待事件  
        （有的系统以线程为调度单位）
5. 栈指针
    - 指向线程私有栈
6. 所属进程指针
    - 指向 PCB  
        用于找到共享资源
---
### 线程私有内存结构
```
|         |  ← 低地址
| 代码段   |  ← 共享
| 数据段   |  ← 共享
| 共享堆   |  ← 共享（向下增长）
|         |
|         |
| 线程栈1  |  ← 向上增长（每个线程独立）
| 线程栈2  |  ← 向上增长（每个线程独立）
|   ...   |  ← 高地址
```
- **只有栈是线程私有的**
- 不存在单独的“线程代码段 / 线程数据段”
- 不存在BSS段
- 线程靠 **独立栈 + PC + 寄存器** 区分执行位置
- [[线程栈保护]]