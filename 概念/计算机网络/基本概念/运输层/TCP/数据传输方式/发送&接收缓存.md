---

---
> Summary：
> 发送端缓冲区：应用写入的数据先存入发送缓存，再分段发送。
> 接收端缓冲区：乱序或尚未确认的数据会存缓冲区，按顺序交给应用。
> 流量控制：上述两者读取速率相匹配
### 发送缓存（Send Buffer）
- 作用：保存应用层**要发送**的数据，还没被对方确认（ACK）的数据。
- 流程：
```
应用层数据
    ↓
TCP发送缓存（未发送 / 已发送未确认）
	↓（TCP封装成报文段）
TCP报文段 + IP首部
    ↓
网络传输
    ↓
到达对方接收缓存
``` 
- 特点：
    - 数据可能在缓存中等待被分段发送。
    - 数据发送后，需要等待 ACK 才能从发送缓存中移除。
    - 发送的报文段长度受 [[MSS最大报文长度|MSS]] 限制。

---
### 接收缓存（Receive Buffer）
- 作用：保存**收到的** TCP 报文段，等待应用层读取。
- 流程：
```
TCP报文段（网络层接收）
    ↓
TCP接收缓存（按序存放）
    ↓（应用层读取）
应用层数据
```
- 特点：
    - TCP 可能乱序到达，因此接收缓存需要按序排列。
    - 缓存中保存的数据可能未被应用层读取。
    - 当应用层读取数据后，TCP 才可以从缓存中移除对应数据。
    - 如果缓存满，TCP 会告知发送端减慢发送速度（流量控制，利用窗口大小）。
---
### **对比表**

|特性|发送缓存|接收缓存|
|---|---|---|
|作用|保存待发送或未确认的数据|保存已收到但未读取的数据|
|数据来源|应用层|网络层|
|数据去向|网络传输 / 等待 ACK|应用层读取|
|是否按序|按发送顺序|按序排列（处理乱序）|
|流控|根据对方窗口调整发送速率|告知发送端窗口大小|
|数据移除条件|收到 ACK|应用层读取数据|
### 收发匹配方式：流量控制
- 目的：发送方的发送速率和接收方应用程序的**读取速率相匹配**
- 发送方：维护接收窗口，指示接收方还有多少可用缓存空间（TCP是全双工所以双端都有）
- 当接收主机的接收窗口为0时，发送端继续发送只有一个字节数据的报文段以确保接收端后续会有新的空间