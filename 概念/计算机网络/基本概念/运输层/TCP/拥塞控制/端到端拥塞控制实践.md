#### 拥塞控制
- 使用的为[[拥塞控制原理#端到端拥塞控制|端到端拥塞控制]]而非[[拥塞控制原理#网络辅助的拥塞控制|网络辅助拥塞控制]]，因为IP层不向系统提供显式的网络拥塞反馈
##### 如何检测拥塞
- 拥塞窗口 cwnd：对一个TCP发送方能向网络发送流量的速率进行了限制
- 接收窗口 rwnd
- 序号 LBR，确认号 LBA
- $LBR - LBA <= min| cwnd, rwnd|$ 
	-> 一个发送方中未被确认的数据量不会超过cwnd与rwnd中的最小值
- [[自计时]]：TCP通过使用确认（ACK）来触发（或计时）增大它的拥塞窗口长度
##### 如何控制发送速率
- 一个丢失的报文段意味着拥塞，则当*丢失报文段时*应降低TCP发送方的速率
- 一个确认报文段指示该网络正在向接收方交付发送方的报文段，因此在*未确认报文段的确认到达时*，能够增加发送方的速率
- 带宽检测：用ACK指示无拥塞
##### 拥塞控制算法
![[Pasted image 20251015101240.png]]
![[Pasted image 20251202091141.png]]
1. 慢启动
	- 初始 cwnd = 1[[MSS最大报文长度|MSS]] 
	- 初始 v = MSS / RTT
	- 每当传输的报文段首次被确认就**翻倍** 
	- 若是超时：ssthresh = cwnd/2，cwnd 重置为 1 MSS（回到慢启动）
	- 若是3 dup ACK（快速重传）：ssthresh = cwnd/2，cwnd = ssthresh + 3×MSS（进入快速恢复）
	- 当无丢包但有声明设置的拥塞控制初始阈值（也就是慢启动阈值ssthresh）时，当cwnd == ssthresh，则转换为只增加一个MSS
2. 拥塞避免
	- cwnd变为上次遇到拥塞时的一半
	- 此时RTT只将cwnd的值增加一个MSS（而非翻倍）
	- 当出现丢包 / 检测到拥塞 / 检测到三个冗余ACK 时停止增长，将cwnd减半，并将慢启动阈值（ssthresh）设为cwnd/2
3. 快速回复
	- 对收到的每个冗余的ACK，cwnd += MSS
	- 丢失报文的一个ACK到达 -> TCP在降低cwnd之后进入拥塞避免状态
	- 出现超时事件 -> 执行如同慢启动 / 拥塞避免中相同的动作 -> 迁移到慢启动状态
- 性质：加性增，乘性减（AIMD）
