---
aliases:
  - P-RDT
---
- [[可靠数据传输原理|rdt]]的性能问题核心：是一个停等协议，而停等协议的利用率很低
### 优化：
- 在等待前分组ACK的同时向客户端发送新的分组
- 由上述可见，P-RDT的分组序号不能再由01标识，也就是说返回的ACK不能再是1bit
### 解决差错恢复
#### 回退N步GBN（滑动窗口协议）
- 允许发送方发送多个分组而不需要等待确认
- 未确认的分组数不能超过N（窗口长度）
- 目的：流量控制
- 分组序号：序号范围为序号字段比特数的 $[0, 2^k - 1]$ 
- TCP有一个32bit的序号字段，是按字节流中的字节计数的，而非按分组计数（TCP 的序号不是“第几个分组”，而是“第几个字节”）
![[Pasted image 20251011112950.png]]
![[Pasted image 20251011113003.png]]
##### 必须响应的三种类型事件
1. 上层的调用：检测发送窗口是否已满（为N） -> 未满则产生一个分组并发送，已满则将数据返回给上层，隐式指示已满
2. 收到一个ACK：累积确认
3. 超时事件：发送方重传所有已发送但还未被确认的分组，若收到ACK但有分组未确认则重启定时器
##### 接收方
1. 若分组k已接收并交付，则所有比k序号小的分组也已经交付
2. 由此可见使用累积确认是GBN的一个自然选择
3. 丢弃所有失序分组（即使已经被正确接收），重传之前有序分组的最后一位的ACK
4. 优点：接收方缓存简单
5. 缺点：需要更多的重传
#### 选择重传SR
- 让发送方仅重传那些它怀疑在接收方出错的分组，从而达到避免不必要重传的效果
- SR将确认一个正确接收的分组而不管其是否按序，**失序的分组**将被缓存，直到丢失分组皆被正确接收，然后再交给上一层
![[Pasted image 20251011150318.png]]
- 在SR中发送方和接收方的窗口并不总是一致
- 当分组序号小于分组数时，容易出现接收到分组但不清楚这是重传还是新分组的情况
- 这导致窗口长度比序号空间小1时协议无法工作，窗口长度必须<=序号空间大小的一半