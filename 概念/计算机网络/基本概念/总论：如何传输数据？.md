## 连网阶段
### 1. DHCP获取IP
1. [[分配IP地址|DHCP]]请求报文
	->[[运输服务（协议）|UDP]]报文段
	->[[网际寻址|IP]]数据报：广播IP = 255.255.255.255，源IP = 0.0.0.0 
	->[[链路层寻址&ARP|以太网帧]]：目的MAC = FF:FF:FF:FF:FF:FF，源MAC = pc MAC
2. 发给[[链路层交换机]] 
	-> 交换机存储源MAC，向别的接口广播该帧
3. [[路由器]]（含DHCP服务器）接收到该帧 
	-> 将DHCP报文拆分给服务器 
	-> 服务器为用户[[分配IP地址#获取一个IP|分配IP]]+网关IP+DNS服务器地址
4. DHCP ACK报文
	->[[UDP]]报文段
	->IP：广播IP = 255.255.255.255，源IP = DHCP服务器IP
	->以太网帧：目的MAC = FF:FF:FF:FF:FF:FF，源MAC = DHCP服务器MAC
5. pc记录其分配的IP，DNS服务器IP，网关IP
### 2. [[链路层寻址&ARP|ARP]]
1. [[链路层寻址&ARP|ARP]]报文：包含源IP = pc IP，源MAC = pc MAC，目的IP = 网关 IP，目的MAC = 0.0.0.0
	->以太网帧：目的MAC = FF:FF:FF:FF:FF:FF，源MAC = pc MAC
2. 节点收到广播帧
	->链路层接收，任何收到广播 MAC 的主机都会拿到帧
	->检查 EtherType：如果 EtherType = 0x0806 → 是 ARP
    ->ARP 报文解析：
    - 节点看 目标IP 是否是自己的 IP
    - 如果不是 → 丢掉，不处理
    - 如果是 → 生成 ARP Reply
    -> 由此只有网关做出ARP ACK
3. 网关记录pc的IP和MAC进ARP表，并向其返回自己的MAC
4. 本地ARP表记录网关IP和MAC映射
---
## 连接服务器阶段
### 1. DNS解析域名获取IP
![[a767a2857752e1051ef5145db8215ce2.png]]
1. [[DNS：目录服务|DNS]]请求报文
	->[[运输服务（协议）|UDP]]报文段
	->[[网际寻址|IP]]数据报：目的IP = DHCP时获取的DNS服务器IP，源IP = pc IP
	->[[链路层寻址&ARP|以太网帧]]：目的MAC = 网关MAC，源MAC = pc MAC
2. 经过几次子网之间的跳跃（[[边界网关协议BGP|BGP]]）后到达DNS服务器所在子网，获取DNS ACK
### 2. [[Web和HTTP#三次握手|三次握手]]
1. [[Web和HTTP|HTTP]]请求报文GET
	->[[TCP]][[套接字]] 
	->IP数据报：目的IP = 目标服务器IP，源IP = pc IP
	->[[链路层寻址&ARP|以太网帧]]：目的MAC = 网关MAC，源MAC = pc MAC
2. [[边界网关协议BGP|BGP]] 跳路由器
3. 进行三次握手
---
## 应用层部分
### 1. cookie的传输
---
## 网安部分
### 1. HTTPS进行TSL/SSL握手
### 2. 