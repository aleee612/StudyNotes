---
aliases:
  - 边界网关协议
  - BGP
---
- [[自治系统AS|AS]]之间的路由选择协议
- 也用于实现[[IP任播]]
- [[距离向量算法DV|DV]]类的协议，分布式 & 异步
### 作用
- 解决OSPF无法连接AS外部路由器的问题
### 工作方式
- 分组并非路由到几个特定的目的地址，而是 路由到[[无类别域间路由选择CIDR|CIDR]]化 的前缀，每个前缀表示一个子网或一个子网的集合
- 一个地址可以采用a.b.c.d/x的形式，这包含了1024个IP地址
- 一台路由器的转发表将具有形式为`（x，I）`的表项（`x`为前缀（即`a.b.c.d/x`），`I`是该路由器的接口之一的接口号）
### 手段
1. 从邻居的AS获得前缀的可达信息：BGP允许每个子网向因特网的其余部分通告它的存在，从而使每个AS知道它的存在
2. 确定到该前缀的“最好的”路由：为确定最好的到前缀的路由，路由器将本地运行一个BGP路由选择过程
#### 通告信息
- 每台路由器要么是网关路由器（AS边缘的路由器，直接连到另一个AS的路由器）要么是内部路由器
- 发送BGP报文向别的AS通告本子网的信息，并由此得出通向我的路径
- 路由器间端口：179
- 应用层协议：[[TCP]]（做到可靠、持久）
- 通过连接发送的BGP报文称为BGP连接
- 外部BGP（eBGP）：跨越两个AS的BGP
- 内部BGP（iBGP）：在相同两个AS的两个路由器之间的（还没传播出去），并不总是与物理链路相对应
#### 确定最好的路由
- 路由器在前缀中包括一些BGP属性（统称为路由）
- AS-PATH：包含已通过的AS的列表。每当前缀通过一个AS，就将该列表加入列表的起始（e.g：AS2，AS3；x（x为子网的前缀））
- NEXT-HOP：是AS-PATH起始的路由器接口的IP地址
### 算法
#### 热土豆路由选择
- 谁先碰到数据报，谁就赶紧把它往外扔：
>当我（一个 AS）要把流量交给另一个 AS 时，  
>我会选择离我最近的出口点（egress router）去交出去，  
>让对方去管后面的路
- 选择的路由到开始的路由的NEXT-HOP路由器具有最小开销
- 减小自己的开销，而忽略其他AS的开销
#### 路由选择算法
- 路由被指派一个本地偏好值作为属性值一，具有最高本地偏好值得路由将被选择
- 从余下的路由中（相同最高本地偏好值），选择具有最短AS-PATH的路由（BGP使用距离向量算法决定路径）
- 从余下的路由中（具有相同的最高本地偏好值和相同的AS-PATH长度），使用热土豆路由选择
- 如仍留下多条路由，使用BGP标识符来选择路由
