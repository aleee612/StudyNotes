---
aliases:
  - DNS
---
- 一个由分层的DNS服务器实现的分布式数据库
- 使主机能够查询分布式数据库的应用层协议
- 运输层协议：运行在[[运输服务（协议）|UDP]]上，53号端口
- 也存在客户 - 服务器运行模式
### 服务内容：
#### 1. 将用户提供的主机名解析为IP地址
##### 步骤
1. 客户端运行DNS应用，（浏览器等）抽取主机名给客户端
2. DNS客户向服务器发送一个包含主机名（类似www.baidu.com）的请求
3. DNS客户收到一份回答报文，包含对应于该主机名的IP地址
4. （浏览器等）接收来自DNS的该IP地址，就能向该IP地址80端口的HTTP服务器进程发起一个TCP连接
##### 域名解析过程
- 查询主机顺序：
	本地域名服务器
	-> 根域名服务器
	-> 顶级域名服务器
	-> 权限域名服务器（转化主机名为IP的位置）
- 域名结构：![[Pasted image 20251126090214.png]]
#### 2. 主机别名
- 应用程序可以调用DNS来获得主机别名对应的**规范主机名**以及主机的IP地址
#### 3. 邮件服务器别名
- 使邮件地址更好记
- 允许邮件服务器和Web服务器使用相同（别名化）的主机名
#### 4. 负载分配
- 繁忙的站点被冗余分布在多台（Web）服务器上，每台服务器均运行在不同的端系统上，每个有着不同的IP地址
- 由此，一个IP地址的集合与同一个规范主机名相对应
- 在每次响应中循环这些地址次序
### 分布式设计
#### 集中式设计的弊端
- 单点故障：一个崩溃整体崩溃
- 通信容量：要处理所有的DNS查询
- 远距离的集中式数据库：导致严重时延
- 维护：不得不为所有主机保留记录，数据庞大且更新频繁
#### 分布式、层次数据库
- 没有一台DNS服务器拥有因特网上所有主机的映射
- 三种类型服务器：
	- 根DNS服务器：客户首先联系的服务器，返回TLD服务器的IP(com)
	- 顶级域（TLD）DNS服务器：返回权威服务器IP(baidu.com)
	- 权限（授权）DNS服务器：为主机名返回其IP地址(www.baidu.com)
- 本地DNS服务器：由ISP管理，起代理转发局域网内主机DNS请求的作用
- 查询方式：递归查询&迭代查询
	1. **主机**向**本地**域名服务器的查询都是**递归**
		- 在本地不知道被查询域名对应IP的情况下，本地服务器以DNS客户的身份去向根域名服务器发出查询请求报文
		- 由此可得主机只会发起一次查询动作
	2. 本地域名服务器向其他域名服务器采用递归 / 迭代
		- 递归：本地域名服务器只向根域名服务器查询一次，后面的查询由其他域名主机完成，递归的职责是必须给出最终答案
		- 迭代：本地域名服务器需要接收根域名服务器的返回报文，并继续向别的域名服务器发送查询，迭代的职责就是只给出它知道的下一级服务器的地址
### DNS缓存
- 目的：改善时延，减少网路中DNS报文数量
- 原理：一个请求链中某DNS服务器接收DNS回答后能**将映射缓存在本地存储器中**
- 缓存并非永久，一般在一段时间（两天）将丢弃缓存信息
### DNS记录和报文
#### 资源记录（RR）
- 提供了主机名到IP的地址映射
- 记录格式：`(Name, Value , Type , TTL)`四元组
- TTL：该记录的生存时间，决定何时删除该记录
- Type：决定Name和Value的值
	- A：Name 是主机名， Value 是该主机名对应的 **IP 地址**
	- NS：Name 是个域（如 foo. com) , 而 Value 是个知道如何获得该域 中主机 IP 地址的**权威 DNS 服务器**的主机名
	- CNAME：**Value** 是别名为 Name 的主机对应的**规范主机名**
	- MX ：Value 是个别名为 Name 的**邮件服务器**的规范主机名 。
#### DNS报文
![[Pasted image 20251004142441.png]]
- 首部：前12个字节，四个数量有关字段决定了后四类数据的数量
- 问题：正在进行的查询信息
- 回答：对最初请求的名字的资源记录RR
- 权威：其他权威服务器的记录
- 附加：其他有帮助的记录
#### 在DNS数据库中插入记录
1. 在注册登记机构注册域名
2. 提供基本和辅助权威DNS服务器的名字和IP地址
3. 确保用于Web服务器的域名的类型A资源记录和用于邮件服务器的类型MX资源记录被输入权威DNS服务器中