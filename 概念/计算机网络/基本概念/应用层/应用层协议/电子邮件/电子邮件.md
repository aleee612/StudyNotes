---
aliases:
  - SMTP
  - POP3
  - IMAP
---

### 组成部分
#### 用户代理
 - 允许用户阅读、回复、转发、保存和撰写报文
 - 通常运行在自己PC上
#### 邮件服务器
- 有一个**外出报文队列**用于存储接收的邮件，一个**报文队列**用于存储发送的邮件
- 有用户邮箱，管理和维护发送给用户的报文
- **报文队列**用于存储未能发送的邮件，并在以后再次尝试发送（通常30分钟间隔）若实在不能成功则删除报文并以邮件形式通知发送方
- 通常由用户的[[ISP]]进行维护
#### 简单邮件传输协议（SMTP）
- 运输层：[[运输服务（协议）#TCP服务|TCP]] 
- 通信方式：推
- 服务器端口：25
- 是否有连接：是
- 同样分为客户端和服务器端（发送/接收邮件）
- 限制所有邮件报文的体部份（不只是首部）只能采用简单的7比特ASCLL表示（这导致在传输多媒体文件时需将二进制多媒体数据编码为ASCLL码）
- 由此提出[[多用途因特网邮件扩展MIME]]
- SMTP一般不使用中间邮件服务器（像[[Web缓存]]那样）发送邮件
##### SMTP握手协议
1. 在建立TCP连接后
2. SMTP客户指示接收方和发送方的邮件地址
3. SMTP客户与服务器通过[[命令]]和[[状态码]]（响应码）交流
4. 客户发送一个只包含一个句点的行表示报文结束
5. 当且仅当所有邮件发送完后才发送QUIT
##### 与HTTP的区别
- HTTP是一个拉协议（客户向服务器拉取，TCP由服务器发起），SMTP是一个推协议（发送服务器推向接收服务器，TCP由客户发起）
- SMTP要求报文格式为7比特ASCLL，TCP不受此限制
- HTTP把每个对象封装到每个报文中，而SMTP将所有对象封装到一个报文中
##### 报文格式
![[Pasted image 20251003215620.png]]
- 首部（必须包含，是作为报文自身的一部分）：
	- From：发件人地址
	- To：收件人地址
- 在首部后紧接着一个空白行，然后是以ASCLL格式表示的报文体
### 邮件访问协议
- 解决SMTP是推协议而无法由用户代理使用SMTP得到邮件服务器上报文的问题
#### POP3
- 端口号：110
- 运输层服务：TCP连接
- 通信方式：拉
- 同SMTP，在不使用MIME时传输的为纯ASCLL
- 倾向于将文件下载到本地，（可选）并将服务器上的报文删除
##### 工作流程：
- 特许：用户代理（明文）发送用户名和口令，鉴别用户
	- `user <user name>`
	- `pass <password>`
- 事务处理：用户代理取回报文，同时可进行（取消）删除标记
- 更新：客户发出quit后结束POP3，同时删除被标记的报文
##### 服务器回答：
- + OK：指示前面的命令是正常的
- - ERR：指示前面的命令出现某些差错
#### IMAP
- 远程服务器上的层次文件夹
- 将每个报文与一个文件夹联系起来
	- 当报文第一次到达服务器时，与收件人的INBOX文件夹相关联
	- 收件人能将其移到一个新的、用户创建的文件夹中，阅读、删除邮件
- 维护了IMAP会话的用户状态信息（e.g：文件夹名，报文关联）
- 具有允许用户代理获取报文某些部分的命令
- 是否有连接：是
#### 基于Web的电子邮件
- 用户与远程邮箱（服务器）：通过HTTP进行
- 用户代理：浏览器