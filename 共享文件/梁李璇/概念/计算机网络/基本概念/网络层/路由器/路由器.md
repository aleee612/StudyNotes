## 工作原理
### 基本结构
#### 输入端口
1. 线路端接：执行入路由器的**物理层功能**
2. 与链路远端的数据链路层交互来执行数据链路层功能
3. 通过查询表（转发表副本）执行查找功能决定输出接口（而非次次在路由选择处理器计算）
4. 控制分组 -> 路由选择处理器；普通数据报 -> 交换结构
![[Pasted image 20251015202533.png]]
##### 转发表匹配方式：
1. 目的地址范围匹配
2. 前缀匹配（当有多个匹配时使用最长前缀匹配机制）
3. 对于大型转发表：使用超出简单线性搜索的技术（快速查找算法），对内存访问时间优化（DRAM，SRAM，TCAM）
##### 其他：
1. 必须出现物理层 & 数据链路层处理
2. 必须检查分组的版本号、检验和 以及寿命字段，并重写后两个字段
3. 必须更新用于网络管理的计数器（e.g：接收到的IP数据报的数目）
#### 交换结构
- 将路由器的输入端口连接到输出端口（物理上）
##### 交换方式
1. 经内存交换
	- 在cpu的直接控制下完成，输入/输出接口就如同I/O设备
	- 分组从输入端口被复制到处理器内存中，处理器从首部提取目的地址，在转发表中找出合适的出口（二次查找，第一次是在输入端口）
	- 将分组复制到输出端口的缓存中
2. 经总线交换
	- 输入端口经一根共享总线直接将分组传送到输出端口，不需要路由选择器
	- 所有输出端口都能接收分组，但只有与标签匹配的端口才能保存分组
	- 分组标签在输入端口计划，在输出端口被去除
	- 路由器带宽受总线速率限制
3. 经互联网络交换
![[Pasted image 20251017111938.png]]
- 总线数：2N -> 连接N个输入端口和N个输出端口
- 总线交叉点通过**交换结构控制器**能够在任何时候开启和闭合（由此来控制去往哪个输出端口）
- 非阻塞：能够并行转发多个分组，只要没有其他分组被转发到当前输出端口（即占用该端口），转发到输出端口的分组将不会被到达输出端口的分组阻塞（即过去的路不会被堵）
#### 输出端口
- 存储从交换结构接收的分组
- 当一条线路是双向时，输出端口常与该链路的输入端口成对出现在同一线路卡上
##### 排队处理
1. 输入排队
	- 交换结构速率 < 输入端口接收速率 * 输入端口数
	- 输入端口内存满了
	- 会发生[[HOL阻塞]]
2. 输出排队
	- 交换速率 > 端口速率
	- 输出端口内存满了
	- 会发生弃尾（丢弃到达的分组），或删除已排队的分组
	- 解决策略：AQM，RED
##### 分组调度（跟那个操作系统里的进程服务一样的体系）
1. FIFO先来先服务：
	- 顾名思义
	- 缓存满了根据解决策略决定是后来的丢弃or去除其他分组
2. 优先权排队：
	- 分抢占式/非抢占式
	- 非抢占式：一但分组开始传输则不能被打断；抢占式：可抢占低优先权的分组
3. 循环加权公平排队：
	- 第i类将确保收到的服务部分等于 权/所有类的权总和
#### 路由选择处理器
- 执行控制平面功能（路由选择协议，维护路由选择表，关联链路状态信息，为该路由计算转发表）
#### 处理所需信息
1. 基于目的转发：基于目的地址的转发，输出端口确定
2. 通用转发：转发输出端口与报文的信息有关