# 属性动画animation

### 基本使用方法：

```
@State flag: boolean = true；
@State widthSize: number = 160;
@State heightSize: number = 80;

Button('改变大小')
  .onClick(() => {
    if (this.flag) {
      this.heightSize = 60;
    } else {
      this.heightSize = 80;
    }
    this.flag = !this.flag;
  })
  .margin(35)
  .width(this.widthSize)
  .height(this.heightSize)
  .animation({
    duration: 2000,//动画时长
    curve: Curve.EaseOut,//动画曲线，以低速结束
    iterations: 1,//动画循环次数
    playMode: PlayMode.Normal//动画每次迭代时的播放方向
  })
```

### 基本属性：

1. `duration`：设置动画的时长（注：不是帧数），单位为毫秒
2. `curve`：设置动画曲线，值要带有Curve

curve取值基本效果

- Linear 表示动画从头到尾的速度都是相同的。
- Ease 表示动画以低速开始，然后加快，在结束前变慢
- EaseIn 表示动画以低速开始
- EaseOut 表示动画以低速结束
- EaseInOut 表示动画以低速开始和结束
- FastOutSlowIn 标准曲线
- LinearOutSlowIn 减速曲线
- FastOutLinearIn 加速曲线
- ExtremeDeceleration 急缓曲线
- Sharp 锐利曲线
- Rhythm 节奏曲线
- Smooth 平滑曲线
- Friction 阻尼曲线

3. `iterations`：设置动画循环次数，设置为-1时无限循环，为除-1外的负数时只循环一次，为0时无动画
4. `playMode`：设置动画每次迭代时的播放方向，需加PlayMode

playMode取值基本效果

- Normal 动画正向播放。
- Reverse 动画反向播放。
- Alternate 动画在奇数次（1、3、5...）正向播放，在偶数次（2、4、6...）反向播放。

- 使用Alternate时当播放次数为奇数时也播放偶数次（即n+1）

- AlternateReverse 动画在奇数次（1、3、5...）反向播放，在偶数次（2、4、6...）正向播放。

5. `delay`：延迟（开始的）触发时间，onFinish不受这个控制
6. `tempo`：播放时长的倍数，与duration结合使用

### 搭配组件使用

- `.rotate`：改变组件旋转角度，其中`angle`的值就是旋转的角度大小
- `.onFinish`：在完成动画之后的回退操作，比如此时就是将旋转了90°的组件再经历一次逆向动画后变回0°

```
Button('改变旋转角度')
  .onClick(() => {
    this.rotateAngle = 90;
  })
  .width(160)
  .margin(35)
  .rotate({ angle: this.rotateAngle })
  .animation({
    duration: 1200,
    curve: Curve.Friction,
    delay: 500,
    iterations: 2,
    playMode: PlayMode.Alternate,
    onFinish: () => {
      this.rotateAngle = 0;
    }
  })
```

## 显式动画animateTo

### 基本使用方法

```
/** 播放完成回调 */
Button('播放完成回调')
  .width(160)
  .onClick(() => {
    animateTo({ duration: 1200,
                curve: Curve.Friction,
                delay: 500,
                iterations: 2,
                playMode: PlayMode.Alternate,
                //tempo: 10,
                onFinish: () => {
                  this.rotateAngleComplete = 0;
                  promptAction.showToast({ message: '动画结束'})
                } }, () => {
      this.rotateAngleComplete = 90;
    });
  })
  .rotate({ angle: this.rotateAngleComplete });
```

### 注意事项：

- `animateTo`中使用`Alternate`时不会触发`n+1`，因为`animateTo` 的闭包 **只在动画开始执行 n 次迭代时调用一次**，或者说它是触发“状态修改”的地方，而不是每次迭代结束都触发。所以看到 **n+1 次迭代**（比如你想让第三次播放又触发闭包）不会执行闭包。