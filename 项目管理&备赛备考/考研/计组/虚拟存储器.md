作用：
- 在 **物理内存** 和 **磁盘存储** 之间创建 抽象的、扩展的内存空间
- 以获取更大的可使用内存空间
核心思路：
- 逻辑地址空间 与 物理内存 的 **解耦**
- 程序所见的地址为 页表和TLB 与 物理内存 映射后的地址
%% 也就是什么栈啊堆啊其实都是虚拟内存的事
	 与物理内存做对应的都是MMU
	 而OS负责规划栈啊堆啊怎么划分，分页算法用哪种 %%
### 页式虚拟存储器
优化点：
- 按需将部分 **页面** 载入内存，其余的页面保存在硬盘上
- 而不需要加载整个虚拟内存
访问虚拟内存 VA：
1. 根据 **虚拟页面号** VPN 找到该地址所在的 **虚拟页面** VP
2. 根据 **页内偏移** VPO 找到该地址
访问物理内存 PA：
3. 根据 **物理页面号** PPN 找到该地址所在的 **物理页面** PP
4. 根据 **页内偏移** PPO 找到该地址
> 需注意：页框 = 物理页面，VPO = PPO（虚拟地址和物理地址的页内偏移量相同）
### MMU
- **地址保护**：确保不同的程序或进程无法越界访问彼此的内存空间
- **内存访问权限**：根据地址映射和保护位（在页表或段表中定义）来控制内存访问权限，包括读、写、执行等
> 在进程执行时，MMU 使用当前活动进程的 **页表** 来执行地址转换
### 页表
存放位置：物理在RAM，虚拟在内核空间
页表位置的位置：CR3
#### 单级页表
- 只需访问一次 **页表** 即可找到 **物理页面号** 
- 结构：![[Pasted image 20260301173904.png]]
#### 多级页表
核心思想：当使用的物理内存不多且不过于分散时，可以不用创建所有的页表
构建方式：分割VPN，以其字段对应不同的小页表
#### 进程切换和页表管理
![[Pasted image 20260301181746.png]]
##### PTBR
作用：
- 指向当前进程顶级页表**物理**地址
- 决定了当前 CPU 看到的是哪一个进程的虚拟地址空间
- **进程切换 = 切换 PTBR**
### TLB
本质：高速缓存
用途：
- 加速MMU工作
- 存储了最近用过的 **虚拟地址** 到 **物理地址** 的映射
结构：
![[Pasted image 20260301204827.png]]
